<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Territorios Salinas</title>

    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Opcional: Leaflet.Draw CSS (no se usa en este ejemplo, pero lo dejaste referenciado) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"
    />

    <style>
      /*==== Estilos Generales ====*/

      #map {
        height: 900px;
        width: 100%;
      }
      #info-panel {
        position: fixed;
        width: 10%;
        top: 50%;
        height: 10%;
        overflow-y: auto;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 15px;
        border-radius: 10px;
        font-family: Arial, sans-serif;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }
      .label {
        font-size: 14px;
        font-weight: bold;
        background: #fff;
        padding: 2px;
        border-radius: 5px;
      }
      .tooltip-content {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .hidden {
        display: none;
      }

      #referencias,
      #ranking-container,
      #contador-poligonos {
        position: fixed;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 15px;
        border-radius: 10px;
        font-family: Arial, sans-serif;
        box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }
      #referencias {
        top: 10px;
        left: 50px;
        width: 250px;
        max-height: 400px;
        overflow-y: auto;
      }
      #ranking-container {
        top: 10px;
        right: 10px;
        width: 250px;
        max-height: 400px;
        overflow-y: auto;
      }
      #contador-poligonos {
        bottom: 10px;
        right: 10px;
        width: 250px;
        max-height: 400px;
        overflow-y: auto;
      }

      .referencias {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 0;
      }
      .referencia {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .color-box {
        width: 20px;
        height: 20px;
        border: 1px solid #000;
      }
      .azul {
        background: rgb(9, 0, 128);
      }
      .verde {
        background: green;
      }
      .amarillo {
        background: yellow;
      }
      .rojo {
        background: red;
      }

      #ranking-container h3 {
        font-size: 16px;
        margin-bottom: 10px;
        text-align: center;
        border-bottom: 1px solid #fff;
        padding-bottom: 5px;
      }
      #ranking-container ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      #ranking-container li {
        font-size: 14px;
        margin: 5px 0;
      }

      #toggle-referencias {
        position: fixed;
        bottom: 80px;
        left: 10px;
        padding: 10px 15px;
        background: #000;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        z-index: 1100;
        display: none; /* Oculto por defecto */
      }
      /*=== Estilo Responsivo=== */
      @media (max-width: 768px) {
        #referencias,
        #ranking-container,
        #contador-poligonos,
        #info-panel {
          display: none;
        }

        #referencias {
          right: 10px;
          font-size: 10px;
          width: 150px;
          top: 10px;
          left: auto;
        }
        .color-box {
          width: 10px;
          height: 10px;
        }

        #ranking-container {
          width: 150px;
          top: 180px;
        }
        #ranking-container li {
          font-size: 10px;
          margin: 4px 0;
        }

        #info-panel {
          width: 150px;
          right: 10px;
          top: 590px;
          height: auto;
          font-size: 10px;
        }

        #contador-poligonos {
          width: 150px;
          font-size: 10px;
          top: 680px;
        }

        #toggle-referencias {
          display: block;
          top: 100px;
          height: 50px;
        }

        /* Animación de escala */
        @keyframes scaleDown {
          0% {
            transform: scale(1);
          }
          50% {
            transform: scale(0.9);
          }
          100% {
            transform: scale(1);
          }
        }

        #toggle-referencias.animate {
          animation: scaleDown 200ms ease-in-out;
        }
      }

      /*========================*/
    </style>
  </head>
  <body>
    <div id="map"></div>

    <div id="info-panel">
      <p><strong>Territorio:</strong> <span id="polygon-id"></span></p>
      <p><strong>Última visita:</strong> <span id="polygon-fecha"></span></p>
    </div>

    <div id="referencias">
      <h3 style="margin-top: 0">Referencias</h3>
      <div class="referencias">
        <div class="referencia">
          <div class="color-box azul"></div>
          <span>Se está trabajando</span>
        </div>
        <div class="referencia">
          <div class="color-box verde"></div>
          <span>Menos de 2 meses (finalizado)</span>
        </div>
        <div class="referencia">
          <div class="color-box amarillo"></div>
          <span>Más de 2 y menos de 3 meses</span>
        </div>
        <div class="referencia">
          <div class="color-box rojo"></div>
          <span>3 meses o más</span>
        </div>
      </div>
    </div>

    <div id="contador-poligonos">
      <h3>Estado de territorios</h3>
      <p>Trabajando: <span id="contador-azul">0</span></p>
      <p>Realizados: <span id="contador-verde">0</span></p>
      <p>Realizar: <span id="contador-amarillo">0</span></p>
      <p>Urgentes: <span id="contador-rojo">0</span></p>
    </div>

    <div id="ranking-container"></div>
    <button id="toggle-referencias">📋 Ver Información</button>"
    <script>
      /*************** CONFIG ***************/
      // CSV publicado (Asegurate de "Publicar en la web" en Google Sheets)
      const SHEET_CSV =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vTNVAikqUbso__rPm_vhOX9DVGigvSf9Lmu97sL4czLgl35CDNEllgyY9WXOAyzdlvVky2wc0SMILqs/pub?gid=1159469350&single=true&output=csv";

      // Cantidad a mostrar en ranking (los más antiguos SIN hacer)
      const N_RANK = 20;

      // Contadores por color
      let contadores = { blue: 0, green: 0, yellow: 0, red: 0 };

      /*************** MAPA ***************/
      const map = L.map("map").setView([-34.777651, -55.855565], 15);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "&copy; OpenStreetMap contributors",
      }).addTo(map);

      /*************** POLÍGONOS (tu dataset) ***************/
      // Datos de los polígonos (sin fechas)
      var poligonos = [
        {
          id: 1,
          coords: [
            [-34.773584, -55.849568],
            [-34.776334, -55.848827],
            [-34.775541, -55.844697],
            [-34.774633, -55.844901],
            [-34.774615, -55.84518],
            [-34.774474, -55.845383],
            [-34.774281, -55.845544],
            [-34.77406, -55.845523],
            [-34.773928, -55.845416],
            [-34.773813, -55.845255],
            [-34.773769, -55.845126],
            [-34.772809, -55.845373],
          ],
        },
        {
          id: 2,
          coords: [
            [-34.772818, -55.845362],
            [-34.771998, -55.841049],
            [-34.774571, -55.840362],
            [-34.774845, -55.84077],
            [-34.775514, -55.844557],
            [-34.774607, -55.844836],
            [-34.774413, -55.844536],
            [-34.774113, -55.84445],
            [-34.773893, -55.8446],
            [-34.773787, -55.844793],
            [-34.773734, -55.845062],
          ],
        },
        {
          id: 3,
          coords: [
            [-34.772007, -55.84106],
            [-34.772809, -55.845373],
            [-34.771919, -55.845534],
            [-34.771258, -55.845383],
            [-34.770791, -55.845222],
            [-34.770403, -55.845051],
            [-34.770429, -55.84474],
            [-34.770368, -55.844471],
            [-34.770068, -55.844246],
            [-34.76983, -55.8443],
            [-34.769671, -55.844461],
            [-34.76946, -55.844139],
            [-34.769028, -55.843538],
            [-34.768799, -55.843109],
            [-34.768684, -55.842766],
            [-34.768561, -55.842369],
            [-34.768446, -55.84195],
          ],
        },
        {
          id: 4,
          coords: [
            [-34.773584, -55.849578],
            [-34.770641, -55.85034],
            [-34.771364, -55.845405],
            [-34.77191, -55.845566],
            [-34.7728, -55.845373],
          ],
        },
        {
          id: 51,
          coords: [
            [-34.770641, -55.850329],
            [-34.767944, -55.851059],
            [-34.766948, -55.850512],
            [-34.769804, -55.84518],
            [-34.769971, -55.845276],
            [-34.770253, -55.845233],
            [-34.770421, -55.845072],
            [-34.771355, -55.845448],
          ],
        },
        {
          id: 6,
          coords: [
            [-34.768455, -55.841961],
            [-34.764242, -55.843087],
            [-34.764939, -55.84695],
            [-34.769046, -55.843549],
            [-34.768728, -55.842862],
          ],
        },
        {
          id: 5,
          coords: [
            [-34.769671, -55.844439],
            [-34.769037, -55.843549],
            [-34.764947, -55.84695],
            [-34.76582, -55.851595],
            [-34.767944, -55.85108],
            [-34.766939, -55.850501],
            [-34.769795, -55.845147],
            [-34.769671, -55.844976],
            [-34.769636, -55.844665],
          ],
        },
        {
          id: 8,
          coords: [
            [-34.775974, -55.844536],
            [-34.775216, -55.840137],
            [-34.782055, -55.838377],
            [-34.782795, -55.842669],
            [-34.778724, -55.843785],
            [-34.778636, -55.843227],
            [-34.776767, -55.844321],
          ],
        },
        {
          id: 7,
          coords: [
            [-34.775974, -55.844514],
            [-34.776803, -55.8443],
            [-34.778636, -55.843248],
            [-34.778724, -55.843828],
            [-34.782848, -55.842669],
            [-34.783553, -55.846918],
            [-34.77675, -55.848699],
          ],
        },
        {
          id: 9,
          coords: [
            [-34.782037, -55.838399],
            [-34.783271, -55.838099],
            [-34.785738, -55.843656],
            [-34.784645, -55.844471],
            [-34.7832, -55.844836],
          ],
        },
        {
          id: 10,
          coords: [
            [-34.7832, -55.844836],
            [-34.784628, -55.844493],
            [-34.785808, -55.843635],
            [-34.788575, -55.849729],
            [-34.786249, -55.850308],
            [-34.786055, -55.849643],
            [-34.78417, -55.850136],
            [-34.783958, -55.849042],
          ],
        },
        {
          id: 11,
          coords: [
            [-34.784152, -55.850136],
            [-34.777296, -55.852003],
            [-34.77675, -55.84872],
            [-34.783588, -55.846939],
          ],
        },
        {
          id: 12,
          coords: [
            [-34.770299, -55.850437],
            [-34.776344, -55.848849],
            [-34.776838, -55.851939],
            [-34.775992, -55.852239],
            [-34.775833, -55.851445],
            [-34.772414, -55.852411],
            [-34.771145, -55.853055],
            [-34.769699, -55.853827],
            [-34.770546, -55.851724],
          ],
        },
        {
          id: 13,
          coords: [
            [-34.766597, -55.851402],
            [-34.766985, -55.85372],
            [-34.768395, -55.853484],
            [-34.769047, -55.853527],
            [-34.769699, -55.853827],
            [-34.77051, -55.851724],
            [-34.770299, -55.850415],
          ],
        },
        {
          id: 14,
          coords: [
            [-34.76702, -55.85372],
            [-34.76702, -55.854042],
            [-34.766403, -55.855436],
            [-34.767813, -55.855651],
            [-34.769717, -55.853848],
            [-34.768977, -55.853484],
            [-34.768272, -55.853484],
          ],
        },
        {
          id: 15,
          coords: [
            [-34.767796, -55.855629],
            [-34.765822, -55.855415],
            [-34.765733, -55.857217],
            [-34.765751, -55.858097],
            [-34.766809, -55.858183],
            [-34.76769, -55.858462],
            [-34.771057, -55.857496],
            [-34.769735, -55.856853],
          ],
        },
        {
          id: 16,
          coords: [
            [-34.767849, -55.855651],
            [-34.769752, -55.853806],
            [-34.77081, -55.854342],
            [-34.772678, -55.856938],
            [-34.772343, -55.85711],
            [-34.771039, -55.857496],
            [-34.769911, -55.856938],
          ],
        },
        {
          id: 17,
          coords: [
            [-34.769735, -55.853784],
            [-34.772379, -55.852454],
            [-34.775851, -55.851445],
            [-34.776203, -55.853527],
            [-34.775111, -55.85417],
            [-34.77437, -55.854428],
            [-34.772996, -55.854492],
            [-34.772273, -55.854793],
            [-34.771356, -55.855093],
            [-34.770775, -55.854321],
          ],
        },
        {
          id: 18,
          coords: [
            [-34.771355, -55.855093],
            [-34.772333, -55.854793],
            [-34.773012, -55.854492],
            [-34.774395, -55.854439],
            [-34.775118, -55.854181],
            [-34.776184, -55.853548],
            [-34.775999, -55.852271],
            [-34.77688, -55.851928],
            [-34.777339, -55.85549],
            [-34.777057, -55.855533],
            [-34.77555, -55.856155],
            [-34.774889, -55.856391],
            [-34.773699, -55.85652],
            [-34.773179, -55.856649],
            [-34.772659, -55.856928],
          ],
        },
        {
          id: 19,
          coords: [
            [-34.777356, -55.85549],
            [-34.778052, -55.861112],
            [-34.777444, -55.861487],
            [-34.776483, -55.860983],
            [-34.775549, -55.861026],
            [-34.775937, -55.860168],
            [-34.776369, -55.858859],
            [-34.7771, -55.855994],
          ],
        },
        {
          id: 20,
          coords: [
            [-34.777127, -55.85593],
            [-34.77569, -55.85638],
            [-34.775585, -55.857453],
            [-34.77547, -55.857636],
            [-34.774404, -55.857818],
            [-34.773778, -55.858644],
            [-34.77347, -55.859202],
            [-34.772641, -55.860994],
            [-34.772342, -55.861723],
            [-34.772324, -55.861959],
            [-34.773082, -55.861713],
            [-34.774245, -55.861273],
            [-34.775532, -55.861026],
            [-34.77599, -55.860039],
            [-34.776492, -55.858408],
          ],
        },
        {
          id: 21,
          coords: [
            [-34.775708, -55.85637],
            [-34.772765, -55.857185],
            [-34.771857, -55.858526],
            [-34.771372, -55.859653],
            [-34.770843, -55.860779],
            [-34.770288, -55.861756],
            [-34.771028, -55.861981],
            [-34.771751, -55.861992],
            [-34.772333, -55.86197],
            [-34.772342, -55.861702],
            [-34.773505, -55.859084],
            [-34.773778, -55.858612],
            [-34.774413, -55.857775],
            [-34.77547, -55.857646],
            [-34.775585, -55.857432],
          ],
        },
        {
          id: 22,
          coords: [
            [-34.772729, -55.857217],
            [-34.772756, -55.857067],
            [-34.772676, -55.856917],
            [-34.772386, -55.85711],
            [-34.767715, -55.858462],
            [-34.766692, -55.858161],
            [-34.765749, -55.858108],
            [-34.766261, -55.860747],
            [-34.766243, -55.861316],
            [-34.76641, -55.861337],
            [-34.766481, -55.861101],
            [-34.766754, -55.860929],
            [-34.769901, -55.860211],
            [-34.770103, -55.859932],
            [-34.771364, -55.859663],
            [-34.771857, -55.858505],
          ],
        },
        {
          id: 23,
          coords: [
            [-34.771364, -55.859663],
            [-34.770297, -55.861788],
            [-34.769398, -55.862539],
            [-34.76641, -55.861348],
            [-34.766481, -55.861101],
            [-34.766745, -55.860908],
            [-34.769901, -55.860211],
            [-34.770121, -55.8599],
          ],
        },
        {
          id: 24,
          coords: [
            [-34.768482, -55.862195],
            [-34.769151, -55.86521],
            [-34.763423, -55.866755],
            [-34.763211, -55.865575],
            [-34.764648, -55.8652],
            [-34.766137, -55.864717],
            [-34.766146, -55.864449],
            [-34.766481, -55.863665],
            [-34.766728, -55.863258],
            [-34.766631, -55.862947],
            [-34.76634, -55.861316],
          ],
        },
        {
          id: 25,
          coords: [
            [-34.76322, -55.865575],
            [-34.766128, -55.864738],
            [-34.766137, -55.864459],
            [-34.766499, -55.863601],
            [-34.766719, -55.863236],
            [-34.766596, -55.862893],
            [-34.766322, -55.861369],
            [-34.765846, -55.861251],
            [-34.765476, -55.861391],
            [-34.765124, -55.861702],
            [-34.764965, -55.861874],
            [-34.764471, -55.862904],
            [-34.764172, -55.863934],
            [-34.763846, -55.864384],
            [-34.763299, -55.86521],
          ],
        },
        {
          id: 26,
          coords: [
            [-34.777331, -55.852025],
            [-34.778547, -55.861402],
            [-34.779623, -55.858762],
            [-34.780627, -55.856853],
            [-34.781702, -55.855672],
            [-34.780751, -55.854106],
            [-34.780257, -55.852711],
            [-34.780046, -55.851402],
          ],
        },
        {
          id: 27,
          coords: [
            [-34.778671, -55.862839],
            [-34.778565, -55.861852],
            [-34.779764, -55.858912],
            [-34.780451, -55.86005],
            [-34.780645, -55.860994],
            [-34.781332, -55.860822],
            [-34.78179, -55.860028],
            [-34.781967, -55.858033],
            [-34.78276, -55.858934],
            [-34.783835, -55.858891],
            [-34.784839, -55.858634],
            [-34.784769, -55.859835],
            [-34.785015, -55.861123],
          ],
        },
        {
          id: 35,
          coords: [
            [-34.78001, -55.851359],
            [-34.783324, -55.85048],
            [-34.783429, -55.850973],
            [-34.78491, -55.85196],
            [-34.785914, -55.853634],
            [-34.784451, -55.854213],
            [-34.784046, -55.854235],
            [-34.783006, -55.854793],
            [-34.781649, -55.855629],
            [-34.780821, -55.854278],
            [-34.780257, -55.852797],
          ],
        },
        {
          id: 36,
          coords: [
            [-34.783324, -55.85048],
            [-34.78609, -55.849771],
            [-34.786249, -55.850308],
            [-34.788628, -55.84975],
            [-34.78965, -55.852196],
            [-34.788434, -55.852582],
            [-34.787324, -55.853226],
            [-34.786831, -55.853419],
            [-34.785879, -55.853655],
            [-34.784839, -55.851853],
            [-34.783429, -55.850952],
          ],
        },
        {
          id: 33,
          coords: [
            [-34.779781, -55.858891],
            [-34.780451, -55.859985],
            [-34.780645, -55.860994],
            [-34.781279, -55.860801],
            [-34.78179, -55.860007],
            [-34.781914, -55.858011],
            [-34.782724, -55.85887],
            [-34.783799, -55.858912],
            [-34.784874, -55.858612],
            [-34.785791, -55.856595],
            [-34.784822, -55.856166],
            [-34.783993, -55.855629],
            [-34.783059, -55.854943],
            [-34.781579, -55.856144],
            [-34.780927, -55.857089],
          ],
        },
        {
          id: 37,
          coords: [
            [-34.783165, -55.854921],
            [-34.784381, -55.855887],
            [-34.785791, -55.856616],
            [-34.786461, -55.856745],
            [-34.787077, -55.856681],
            [-34.787817, -55.856831],
            [-34.789016, -55.857775],
            [-34.789791, -55.85638],
            [-34.790179, -55.854921],
            [-34.790144, -55.853634],
            [-34.789721, -55.852325],
            [-34.788346, -55.852647],
            [-34.787165, -55.853312],
            [-34.785879, -55.853634],
            [-34.784399, -55.854235],
            [-34.784064, -55.854192],
          ],
        },
        {
          id: 49,
          coords: [
            [-34.769151, -55.86521],
            [-34.768464, -55.862163],
            [-34.769416, -55.86256],
            [-34.770306, -55.861799],
            [-34.770976, -55.86197],
            [-34.772289, -55.861981],
            [-34.772685, -55.864288],
          ],
        },
        {
          id: 44,
          coords: [
            [-34.772677, -55.864277],
            [-34.772289, -55.861949],
            [-34.774272, -55.861251],
            [-34.775655, -55.861005],
            [-34.776484, -55.860962],
            [-34.77748, -55.861509],
            [-34.778052, -55.861123],
            [-34.778202, -55.862796],
          ],
        },
        {
          id: 50,
          coords: [
            [-34.767461, -55.865865],
            [-34.769611, -55.86535],
            [-34.76977, -55.86668],
            [-34.772326, -55.870628],
            [-34.771674, -55.870757],
            [-34.770916, -55.870779],
            [-34.770193, -55.87065],
            [-34.769752, -55.870414],
            [-34.769312, -55.870113],
            [-34.768959, -55.869856],
            [-34.768483, -55.869362],
            [-34.768184, -55.868826],
            [-34.767884, -55.868182],
            [-34.76769, -55.867581],
            [-34.767549, -55.866981],
          ],
        },
        {
          id: 52,
          coords: [
            [-34.764947, -55.846918],
            [-34.764242, -55.843066],
            [-34.762092, -55.843635],
            [-34.762823, -55.847551],
          ],
        },
        {
          id: 53,
          coords: [
            [-34.764947, -55.846907],
            [-34.762303, -55.847722],
            [-34.763149, -55.852261],
            [-34.765838, -55.851563],
          ],
        },
        {
          id: 48,
          coords: [
            [-34.769576, -55.865371],
            [-34.772238, -55.864663],
            [-34.772467, -55.865715],
            [-34.774353, -55.868933],
            [-34.772802, -55.870349],
            [-34.772308, -55.870564],
            [-34.769805, -55.866766],
          ],
        },
        {
          id: 46,
          coords: [
            [-34.77222, -55.864663],
            [-34.774846, -55.863934],
            [-34.774846, -55.864491],
            [-34.775022, -55.864964],
            [-34.776327, -55.867109],
            [-34.774317, -55.868955],
            [-34.772467, -55.8658],
          ],
        },
        {
          id: 43,
          coords: [
            [-34.774864, -55.863934],
            [-34.778318, -55.862989],
            [-34.778565, -55.864899],
            [-34.776344, -55.867109],
            [-34.775022, -55.864985],
            [-34.774846, -55.864491],
          ],
        },
        {
          id: 42,
          coords: [
            [-34.77638, -55.867131],
            [-34.778213, -55.870156],
            [-34.779323, -55.869277],
            [-34.778953, -55.867796],
            [-34.778512, -55.864899],
          ],
        },
        {
          id: 45,
          coords: [
            [-34.774388, -55.868955],
            [-34.776327, -55.867088],
            [-34.77816, -55.870156],
            [-34.777895, -55.870349],
            [-34.777525, -55.870242],
            [-34.775957, -55.871508],
          ],
        },
        {
          id: 47,
          coords: [
            [-34.774369, -55.868933],
            [-34.772818, -55.870339],
            [-34.772315, -55.870575],
            [-34.77332, -55.872152],
            [-34.775937, -55.871519],
          ],
        },
        {
          id: 28,
          coords: [
            [-34.778766, -55.862947],
            [-34.780907, -55.862399],
            [-34.78178, -55.86742],
            [-34.782141, -55.868182],
            [-34.781604, -55.868418],
            [-34.781172, -55.868558],
            [-34.781066, -55.868794],
            [-34.780987, -55.869459],
            [-34.780766, -55.869652],
            [-34.780581, -55.869459],
            [-34.780264, -55.868386],
            [-34.779612, -55.868933],
            [-34.779312, -55.867463],
          ],
        },
        {
          id: 29,
          coords: [
            [-34.780899, -55.86241],
            [-34.783084, -55.861799],
            [-34.783948, -55.866884],
            [-34.783939, -55.867109],
            [-34.784106, -55.868053],
            [-34.783701, -55.868161],
            [-34.782784, -55.868257],
            [-34.782141, -55.868214],
            [-34.78178, -55.867431],
          ],
        },
        {
          id: 30,
          coords: [
            [-34.783075, -55.861809],
            [-34.785216, -55.861251],
            [-34.785683, -55.863805],
            [-34.78608, -55.863719],
            [-34.786371, -55.863826],
            [-34.785921, -55.8652],
            [-34.785745, -55.866594],
            [-34.785701, -55.867721],
            [-34.784979, -55.868225],
            [-34.784106, -55.868053],
            [-34.78393, -55.867077],
            [-34.783903, -55.866659],
          ],
        },
        {
          id: 32,
          coords: [
            [-34.785199, -55.861262],
            [-34.787974, -55.8605],
            [-34.788283, -55.86255],
            [-34.787516, -55.864202],
            [-34.786327, -55.863826],
            [-34.786045, -55.863719],
            [-34.785666, -55.863805],
          ],
        },
        {
          id: 31,
          coords: [
            [-34.786353, -55.863858],
            [-34.785913, -55.865157],
            [-34.785727, -55.866702],
            [-34.786256, -55.86682],
            [-34.787393, -55.866905],
            [-34.788292, -55.867538],
            [-34.790265, -55.863247],
            [-34.788283, -55.86256],
            [-34.787516, -55.864202],
          ],
        },
        {
          id: 39,
          coords: [
            [-34.787966, -55.8605],
            [-34.793693, -55.858891],
            [-34.794195, -55.862195],
            [-34.790221, -55.863258],
            [-34.788274, -55.862571],
          ],
        },
        {
          id: 40,
          coords: [
            [-34.790309, -55.863225],
            [-34.794195, -55.862195],
            [-34.793305, -55.865296],
          ],
        },
        {
          id: 41,
          coords: [
            [-34.790283, -55.863247],
            [-34.788283, -55.867517],
            [-34.78912, -55.868118],
            [-34.789093, -55.869437],
            [-34.789719, -55.869952],
            [-34.790944, -55.869126],
            [-34.791825, -55.86726],
            [-34.792671, -55.867871],
            [-34.792168, -55.86859],
            [-34.792274, -55.868762],
            [-34.792944, -55.867871],
            [-34.793402, -55.86536],
          ],
        },
        {
          id: 34,
          coords: [
            [-34.785023, -55.861026],
            [-34.787948, -55.860243],
            [-34.789023, -55.857775],
            [-34.787816, -55.856842],
            [-34.787067, -55.856681],
            [-34.786441, -55.856745],
            [-34.785736, -55.856584],
            [-34.784873, -55.858344],
            [-34.784767, -55.85873],
            [-34.784741, -55.860071],
          ],
        },
        {
          id: 38,
          coords: [
            [-34.787957, -55.860232],
            [-34.793587, -55.858741],
            [-34.792107, -55.856767],
            [-34.792072, -55.856434],
            [-34.791384, -55.855715],
            [-34.791684, -55.854943],
            [-34.790908, -55.853537],
            [-34.790151, -55.853859],
            [-34.790168, -55.854911],
            [-34.789798, -55.856359],
            [-34.789005, -55.857764],
          ],
        },
        {
          id: 64,
          coords: [
            [-34.777549, -55.88777],
            [-34.777531, -55.887298],
            [-34.779029, -55.883973],
            [-34.780598, -55.883501],
            [-34.782413, -55.886505],
          ],
        },
        {
          id: 62,
          coords: [
            [-34.780199, -55.881445],
            [-34.782032, -55.880737],
            [-34.783037, -55.884749],
            [-34.783089, -55.885457],
            [-34.782966, -55.885843],
            [-34.782349, -55.88625],
            [-34.78064, -55.883483],
          ],
        },
        {
          id: 63,
          coords: [
            [-34.780192, -55.881488],
            [-34.780051, -55.880737],
            [-34.780086, -55.87295],
            [-34.781989, -55.880716],
          ],
        },
        {
          id: 67,
          coords: [
            [-34.780082, -55.878214],
            [-34.779183, -55.878139],
            [-34.779122, -55.87697],
            [-34.779051, -55.875833],
            [-34.779139, -55.874331],
            [-34.779148, -55.873784],
            [-34.779051, -55.872808],
            [-34.780109, -55.872958],
          ],
        },
        {
          id: 71,
          coords: [
            [-34.777126, -55.876445],
            [-34.776773, -55.875715],
            [-34.776192, -55.873613],
            [-34.777285, -55.873098],
            [-34.779047, -55.872776],
            [-34.779065, -55.87593],
          ],
        },
        {
          id: 68,
          coords: [
            [-34.779213, -55.878161],
            [-34.778314, -55.878418],
            [-34.777821, -55.877399],
            [-34.77716, -55.87652],
            [-34.777592, -55.87623],
            [-34.778217, -55.876091],
            [-34.778949, -55.875951],
            [-34.77909, -55.876445],
          ],
        },
        {
          id: 69,
          coords: [
            [-34.777221, -55.879147],
            [-34.778366, -55.878439],
            [-34.777926, -55.877646],
            [-34.777344, -55.87683],
            [-34.777226, -55.876647],
            [-34.776278, -55.877473],
          ],
        },
        {
          id: 72,
          coords: [
            [-34.775194, -55.878355],
            [-34.777203, -55.876682],
            [-34.775916, -55.873657],
            [-34.77433, -55.874815],
            [-34.774859, -55.876403],
            [-34.774524, -55.876917],
          ],
        },
        {
          id: 73,
          coords: [
            [-34.766569, -55.851424],
            [-34.762788, -55.852346],
            [-34.762814, -55.852743],
            [-34.762982, -55.853612],
            [-34.763907, -55.855029],
            [-34.764207, -55.855157],
            [-34.765159, -55.854449],
            [-34.766499, -55.853827],
            [-34.766992, -55.853645],
          ],
        },
        {
          id: 74,
          coords: [
            [-34.766992, -55.853634],
            [-34.766992, -55.854095],
            [-34.76641, -55.855469],
            [-34.765811, -55.855447],
            [-34.765714, -55.857722],
            [-34.765767, -55.858108],
            [-34.764586, -55.858022],
            [-34.76433, -55.85741],
            [-34.763995, -55.857056],
            [-34.763264, -55.856595],
            [-34.763599, -55.855951],
            [-34.764216, -55.855168],
            [-34.76515, -55.85446],
            [-34.76634, -55.853881],
          ],
        },
        {
          id: 75,
          coords: [
            [-34.759359, -55.853387],
            [-34.762797, -55.852357],
            [-34.762806, -55.85269],
            [-34.762973, -55.853602],
            [-34.76389, -55.855018],
            [-34.764207, -55.855168],
            [-34.763581, -55.855962],
            [-34.763308, -55.856413],
            [-34.762338, -55.855865],
            [-34.76069, -55.855232],
            [-34.76121, -55.854235],
            [-34.759597, -55.854589],
          ],
        },
        {
          id: 76,
          coords: [
            [-34.766128, -55.859996],
            [-34.766014, -55.860039],
            [-34.765106, -55.85961],
            [-34.764727, -55.859191],
            [-34.764066, -55.859352],
            [-34.76433, -55.860468],
            [-34.76233, -55.861048],
            [-34.762515, -55.862163],
            [-34.764163, -55.861723],
            [-34.765062, -55.861809],
            [-34.7653, -55.86152],
            [-34.765846, -55.861241],
            [-34.766261, -55.861305],
            [-34.766278, -55.860736],
          ],
        },
        {
          id: 77,
          coords: [
            [-34.76069, -55.855243],
            [-34.7601, -55.856327],
            [-34.760047, -55.856584],
            [-34.759959, -55.857239],
            [-34.759712, -55.858129],
            [-34.759315, -55.858623],
            [-34.760505, -55.859159],
            [-34.761378, -55.858934],
            [-34.761616, -55.85902],
            [-34.761783, -55.859267],
            [-34.761889, -55.859942],
            [-34.762559, -55.859803],
            [-34.762638, -55.859621],
            [-34.762832, -55.858065],
            [-34.763, -55.857153],
            [-34.763317, -55.856423],
            [-34.762083, -55.855769],
          ],
        },
        {
          id: 60,
          coords: [
            [-34.780529, -55.871851],
            [-34.780299, -55.871712],
            [-34.780079, -55.870768],
            [-34.78148, -55.87036],
            [-34.781674, -55.86947],
            [-34.781894, -55.869126],
            [-34.782256, -55.868912],
            [-34.782599, -55.868847],
            [-34.784556, -55.869191],
            [-34.785904, -55.868719],
            [-34.786045, -55.869513],
            [-34.785657, -55.869781],
            [-34.784785, -55.870113],
            [-34.78452, -55.870403],
          ],
        },
        {
          id: 61,
          coords: [
            [-34.780388, -55.872248],
            [-34.780529, -55.871851],
            [-34.784503, -55.870425],
            [-34.784802, -55.870092],
            [-34.785639, -55.869813],
            [-34.786054, -55.869523],
            [-34.786662, -55.872055],
            [-34.780819, -55.87418],
          ],
        },
        {
          id: 59,
          coords: [
            [-34.786919, -55.873225],
            [-34.786038, -55.869427],
            [-34.786372, -55.869319],
            [-34.786443, -55.868804],
            [-34.786972, -55.868719],
            [-34.787888, -55.869062],
            [-34.787782, -55.869813],
            [-34.789474, -55.871401],
            [-34.7918, -55.871959],
            [-34.791377, -55.874362],
          ],
        },
        {
          id: 58,
          coords: [
            [-34.786883, -55.873203],
            [-34.791448, -55.874426],
            [-34.791007, -55.876744],
            [-34.787342, -55.875778],
          ],
        },
        {
          id: 57,
          coords: [
            [-34.790997, -55.876744],
            [-34.790644, -55.878943],
            [-34.78734, -55.878128],
            [-34.787551, -55.877033],
            [-34.787331, -55.875757],
          ],
        },
        {
          id: 56,
          coords: [
            [-34.78734, -55.878117],
            [-34.786908, -55.879737],
            [-34.790027, -55.881604],
            [-34.79038, -55.880413],
            [-34.790653, -55.878954],
          ],
        },
        {
          id: 55,
          coords: [
            [-34.786908, -55.879759],
            [-34.785965, -55.882237],
            [-34.78593, -55.88316],
            [-34.786036, -55.88405],
            [-34.786318, -55.884887],
            [-34.786785, -55.885638],
            [-34.787314, -55.886196],
            [-34.78934, -55.883278],
            [-34.790045, -55.881582],
          ],
        },
        {
          id: 54,
          coords: [
            [-34.785974, -55.882183],
            [-34.784741, -55.885166],
            [-34.784644, -55.88611],
            [-34.784661, -55.887247],
            [-34.784785, -55.887719],
            [-34.786177, -55.889812],
            [-34.788353, -55.886915],
            [-34.787455, -55.886014],
            [-34.787296, -55.886207],
            [-34.786741, -55.885617],
            [-34.786274, -55.884908],
            [-34.786018, -55.884018],
            [-34.785913, -55.883224],
          ],
        },
        {
          id: 78,
          coords: [
            [-34.76188, -55.861155],
            [-34.762638, -55.859621],
            [-34.762867, -55.857861],
            [-34.762973, -55.857271],
            [-34.763264, -55.856563],
            [-34.764066, -55.857099],
            [-34.764348, -55.857432],
            [-34.764577, -55.858033],
            [-34.765741, -55.858108],
            [-34.766128, -55.860007],
            [-34.766014, -55.860039],
            [-34.765132, -55.85961],
            [-34.764718, -55.859213],
            [-34.76404, -55.859342],
            [-34.76433, -55.860479],
          ],
        },
        {
          id: 79,
          coords: [
            [-34.765044, -55.861809],
            [-34.764075, -55.861745],
            [-34.762497, -55.862163],
            [-34.76233, -55.862968],
            [-34.762435, -55.863461],
            [-34.762682, -55.863397],
            [-34.762858, -55.864384],
            [-34.764189, -55.863987],
            [-34.764489, -55.862914],
            [-34.764709, -55.862453],
          ],
        },
        {
          id: 65,
          coords: [
            [-34.779092, -55.883975],
            [-34.780634, -55.883374],
            [-34.780097, -55.881057],
            [-34.779912, -55.881046],
            [-34.778493, -55.881625],
          ],
        },
        {
          id: 66,
          coords: [
            [-34.780097, -55.881035],
            [-34.780097, -55.878181],
            [-34.77918, -55.878117],
            [-34.778317, -55.878396],
            [-34.777224, -55.879158],
            [-34.778475, -55.881615],
            [-34.779912, -55.881057],
          ],
        },
        {
          id: 70,
          coords: [
            [-34.779083, -55.883964],
            [-34.778467, -55.881636],
            [-34.77718, -55.879083],
            [-34.776255, -55.877495],
            [-34.77525, -55.878375],
            [-34.777021, -55.887891],
            [-34.777585, -55.887741],
            [-34.77755, -55.887365],
          ],
        },
        {
          id: 80,
          coords: [
            [-34.764182, -55.863998],
            [-34.763601, -55.864727],
            [-34.76323, -55.865479],
            [-34.763424, -55.866787],
            [-34.762613, -55.866981],
            [-34.760568, -55.86535],
            [-34.761203, -55.864813],
          ],
        },
        {
          id: 81,
          coords: [
            [-34.760558, -55.865339],
            [-34.759465, -55.864266],
            [-34.758548, -55.863311],
            [-34.758901, -55.863065],
            [-34.759395, -55.862882],
            [-34.759941, -55.862839],
            [-34.762532, -55.86212],
            [-34.76255, -55.862314],
            [-34.762347, -55.862914],
            [-34.762391, -55.863268],
            [-34.762444, -55.863461],
            [-34.762717, -55.863397],
            [-34.76285, -55.864363],
            [-34.76121, -55.864792],
          ],
        },
        {
          id: 83,
          coords: [
            [-34.757297, -55.861187],
            [-34.755754, -55.856895],
            [-34.758698, -55.856091],
            [-34.760117, -55.856359],
            [-34.759959, -55.857207],
            [-34.759774, -55.857936],
            [-34.759518, -55.858408],
            [-34.758998, -55.858891],
            [-34.758443, -55.860565],
            [-34.758416, -55.860876],
          ],
        },
        {
          id: 82,
          coords: [
            [-34.755754, -55.856863],
            [-34.755225, -55.854492],
            [-34.759386, -55.853387],
            [-34.759588, -55.854621],
            [-34.761193, -55.854256],
            [-34.760717, -55.855222],
            [-34.7601, -55.856327],
            [-34.759033, -55.856112],
            [-34.758636, -55.856102],
          ],
        },
        {
          id: 84,
          coords: [
            [-34.758557, -55.863311],
            [-34.758936, -55.863054],
            [-34.759412, -55.862861],
            [-34.759941, -55.862839],
            [-34.76255, -55.862099],
            [-34.76233, -55.861026],
            [-34.761898, -55.861155],
            [-34.762621, -55.859739],
            [-34.761907, -55.859921],
            [-34.761748, -55.859191],
            [-34.761466, -55.858912],
            [-34.760505, -55.859138],
            [-34.759245, -55.858676],
            [-34.759007, -55.858912],
            [-34.758451, -55.860565],
            [-34.758416, -55.860844],
            [-34.757314, -55.861166],
            [-34.757905, -55.862721],
          ],
        },
        {
          id: 85,
          coords: [
            [-34.785749, -55.890183],
            [-34.785167, -55.889346],
            [-34.784709, -55.889303],
            [-34.784031, -55.88984],
            [-34.785018, -55.891052],
            [-34.785414, -55.890548],
          ],
        },

        /*
            AÑADIDOS LOS TERRITORIOS:


            */
      ];

      /*************** UTILIDADES ***************/
      function diferenciaEnMeses(a, b) {
        return (
          (b.getFullYear() - a.getFullYear()) * 12 +
          (b.getMonth() - a.getMonth())
        );
      }

      function quitarTildes(s) {
        return s.normalize?.("NFD").replace(/\p{Diacritic}/gu, "") || s;
      }

      function parseCSVLine(line) {
        // Parse CSV simple con comillas
        const out = [];
        let cur = "",
          inQ = false;
        for (let i = 0; i < line.length; i++) {
          const ch = line[i];
          if (ch === '"') {
            if (inQ && line[i + 1] === '"') {
              cur += '"';
              i++;
            } else {
              inQ = !inQ;
            }
          } else if (ch === "," && !inQ) {
            out.push(cur);
            cur = "";
          } else {
            cur += ch;
          }
        }
        out.push(cur);
        return out;
      }

      function parseFechaSeguro(s) {
        s = String(s || "").trim();
        if (!s) return new Date("Invalid");
        const d1 = new Date(s);
        if (!isNaN(d1)) return d1;
        const m = s.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);
        if (m) return new Date(+m[3], +m[2] - 1, +m[1]);
        return new Date("Invalid");
      }

      function normalizarFinalizado(v) {
        const s = String(v ?? "")
          .trim()
          .toLowerCase();
        if (!s) return "";
        if (
          [
            "si",
            "sí",
            "s",
            "true",
            "1",
            "ok",
            "finalizado",
            "completo",
            "terminado",
          ].includes(s)
        )
          return "Si";
        if (["no", "n", "false", "0", "pendiente", "incompleto"].includes(s))
          return "No";
        return s;
      }

      function obtenerColor(fecha, finalizado) {
        if (!(fecha instanceof Date) || isNaN(fecha)) return "red";
        const ahora = new Date();
        const diffMeses = diferenciaEnMeses(fecha, ahora);
        const fin = String(finalizado ?? "")
          .trim()
          .toLowerCase();
        const esSi =
          [
            "si",
            "sí",
            "true",
            "1",
            "ok",
            "finalizado",
            "completo",
            "terminado",
          ].includes(fin) || finalizado === true;
        if (diffMeses < 2 && !esSi) return "blue"; // trabajando reciente (no finalizado)
        if (diffMeses < 2 && esSi) return "green"; // finalizado reciente
        if (diffMeses <= 3) return "yellow"; // 2 a 3 meses
        return "red"; // 3+ meses
      }

      function actualizarContadores() {
        document.getElementById("contador-azul").textContent = contadores.blue;
        document.getElementById("contador-verde").textContent =
          contadores.green;
        document.getElementById("contador-amarillo").textContent =
          contadores.yellow;
        document.getElementById("contador-rojo").textContent = contadores.red;
      }

      /*************** FETCH CSV ROBUSTO (con fallbacks CORS) ***************/
      async function fetchTextWithFallback(url) {
        // 1) Directo
        try {
          const r = await fetch(url, { headers: { Accept: "text/csv" } });
          if (r.ok) return await r.text();
        } catch (_) {}
        // 2) Fallbacks (cache proxy read-only de Jina)
        const targets = [
          "https://r.jina.ai/http://" + url.replace(/^https?:\/\//, ""),
          "https://r.jina.ai/https://" + url.replace(/^https?:\/\//, ""),
        ];
        for (const t of targets) {
          try {
            const r = await fetch(t);
            if (r.ok) return await r.text();
          } catch (_) {}
        }
        throw new Error(
          "No se pudo obtener el CSV (CORS/proxy). Serví el HTML desde http://localhost."
        );
      }

      function indicesPorEncabezado(headers) {
        // Mapea columnas por nombre (tolerante a acentos/casos)
        const norm = headers.map((h) =>
          quitarTildes(
            String(h || "")
              .trim()
              .toLowerCase()
          )
        );
        const lookup = (...aliases) => {
          const aliNorm = aliases.map((a) => quitarTildes(a.toLowerCase()));
          for (let i = 0; i < norm.length; i++) {
            if (aliNorm.includes(norm[i])) return i;
          }
          return -1;
        };
        return {
          id: lookup("id", "identificador", "territorio"),
          fecha: lookup(
            "ultima fecha",
            "última fecha",
            "fecha",
            "fecha ultima",
            "fecha última"
          ),
          finalizado: lookup(
            "finalizado",
            "se finalizo el territorio",
            "se finalizó el territorio",
            "¿se finalizó?",
            "se finalizo",
            "se finalizó",
            "estado"
          ),
        };
      }

      async function cargarDatosDesdeSheets() {
        try {
          const csvData = await fetchTextWithFallback(SHEET_CSV);
          const filas = csvData.split(/\r?\n/).filter((l) => l.trim() !== "");
          if (filas.length === 0) return [];

          const headerCols = parseCSVLine(filas[0]);
          let start = 0;
          let idxId = 0,
            idxFecha = 1,
            idxFin = 2;

          // Si la primera fila parece encabezado, detectamos índices por nombre
          const joined = headerCols.join(",").toLowerCase();
          const looksHeader = /id|fecha|finaliz/.test(joined);
          if (looksHeader) {
            const { id, fecha, finalizado } = indicesPorEncabezado(headerCols);
            if (id !== -1) idxId = id;
            if (fecha !== -1) idxFecha = fecha;
            if (finalizado !== -1) idxFin = finalizado;
            start = 1;
          }

          const datos = [];
          for (let i = start; i < filas.length; i++) {
            const cols = parseCSVLine(filas[i]);
            const idStr = (cols[idxId] ?? "").trim();
            const fechaStr = (cols[idxFecha] ?? "").trim();
            const finStr = (cols[idxFin] ?? "").trim();

            const id = parseInt(idStr, 10);
            const fecha = parseFechaSeguro(fechaStr);
            const finalizado = normalizarFinalizado(finStr);

            if (
              Number.isInteger(id) &&
              fecha instanceof Date &&
              !isNaN(fecha)
            ) {
              datos.push({ id, fecha, finalizado });
            }
          }
          return datos;
        } catch (error) {
          console.error("Error cargando datos desde Google Sheets:", error);
          return [];
        }
      }

      /*************** UI: panel info ***************/
      const infoPanel = document.getElementById("info-panel");
      const polygonId = document.getElementById("polygon-id");
      const polygonFecha = document.getElementById("polygon-fecha");

      /*************** CARGA DEL MAPA ***************/
      async function cargarMapa() {
        const datosSheets = await cargarDatosDesdeSheets();

        // Reset contadores
        contadores = { blue: 0, green: 0, yellow: 0, red: 0 };

        poligonos.forEach((p) => {
          const dato = datosSheets.find((d) => d.id === p.id);
          p.fecha = dato ? dato.fecha : null;
          p.finalizado = dato ? dato.finalizado : "";

          const colorInicial = obtenerColor(p.fecha, p.finalizado);
          if (contadores[colorInicial] != null) contadores[colorInicial]++;

          const poly = L.polygon(p.coords, {
            color: "black",
            fillColor: colorInicial,
            fillOpacity: 0.5,
          }).addTo(map);

          const tooltipContent = `
          <div class="tooltip-content">
            <div><strong>${p.id}</strong></div>
          </div>
        `;
          poly.bindTooltip(tooltipContent, {
            permanent: true,
            direction: "center",
            className: "label",
          });

          poly.on("click", function () {
            infoPanel.style.display = "block";
            polygonId.textContent = p.id;
            polygonFecha.textContent =
              p.fecha instanceof Date && !isNaN(p.fecha)
                ? p.fecha.toLocaleDateString()
                : "Fecha no disponible";
          });
        });

        actualizarContadores();
      }

      /*************** RANKING (SIN HACER, MÁS ANTIGUOS) ***************/
      async function mostrarRanking() {
        try {
          const datosSheets = await cargarDatosDesdeSheets();
          if (!Array.isArray(datosSheets) || datosSheets.length === 0) {
            document.getElementById("ranking-container").innerHTML =
              "<h3>Territorios sin hacer</h3><p>No se pudieron cargar datos.</p>";
            return;
          }

          // Sin hacer => finalizado distinto de 'Si'
          const sinHacer = datosSheets.filter(
            (d) => String(d.finalizado).toLowerCase() !== "si"
          );

          // Ordenar por fecha (más antigua primero)
          sinHacer.sort((a, b) => a.fecha - b.fecha);

          // Tomamos N más antiguos
          const lista = sinHacer.slice(0, N_RANK);

          let html = "<h3>Territorios sin hacer</h3><ul>";
          const hoy = new Date();
          for (const d of lista) {
            const fechaTxt =
              d.fecha instanceof Date && !isNaN(d.fecha)
                ? d.fecha.toLocaleDateString()
                : "-";
            const meses =
              d.fecha instanceof Date && !isNaN(d.fecha)
                ? diferenciaEnMeses(d.fecha, hoy)
                : "?";
            html += `<li>${d.id} - ${fechaTxt} (${meses} mes${
              meses === 1 ? "" : "es"
            })</li>`;
          }
          html += "</ul>";

          document.getElementById("ranking-container").innerHTML = html;
        } catch (e) {
          console.error(e);
          document.getElementById("ranking-container").innerHTML =
            "<h3>Territorios sin hacer</h3><p>Error al cargar datos.</p>";
        }
      }

      /*************** INIT ***************/
      mostrarRanking();
      cargarMapa();
      // Sugerencia: refresco cada X minutos (opcional)
      // setInterval(() => { mostrarRanking(); /* y si querés: recargar mapa */ }, 5 * 60 * 1000);

      /*************** EVENTOS ***************/
      document.addEventListener("DOMContentLoaded", function () {
        const btn = document.getElementById("toggle-referencias");
        const paneles = [
          document.getElementById("referencias"),
          document.getElementById("ranking-container"),
          document.getElementById("contador-poligonos"),
          document.getElementById("info-panel"),
        ];

        let visible = false;

        btn.addEventListener("click", function () {
          // Animación de escala
          btn.classList.add("animate");
          setTimeout(() => btn.classList.remove("animate"), 200); // Dura lo mismo que el @keyframes

          // Mostrar u ocultar paneles
          visible = !visible;
          paneles.forEach((panel) => {
            if (panel) {
              panel.style.display = visible ? "block" : "none";
            }
          });

          // Cambiar texto del botón
          btn.textContent = visible
            ? "❌ Ocultar Información"
            : "📋 Ver Información";
        });
      });
    </script>
  </body>
</html>
